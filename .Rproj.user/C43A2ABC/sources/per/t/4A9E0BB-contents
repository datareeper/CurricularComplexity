#ASEE 2021 Curricular Analyses for Transfer Students#
#David Reeping & Dustin Grote#

#Load necessary packages
packages <- c("CurricularComplexityCalculator")
lapply(packages, library, character.only = TRUE)


#Import all of the plans of study from the same folder#

folder <- "/Users/reepi/Dropbox/Articles/RED curricular analyses/Analysis Data/CSV Files for Upload"
file_list <- list.files(path=folder, pattern="*.csv")
data <- lapply(file_list, function(x) read.csv(x,header = TRUE, stringsAsFactors = FALSE))
plan_of_study_names <- unlist(strsplit(file_list, split=".", fixed = TRUE)) #get the names of each plan of study
csv_strings_to_remove <- which(plan_of_study_names == "csv") #remove the csv extentions, don't need them
plan_of_study_names <- plan_of_study_names[-csv_strings_to_remove] #deletes the "csv" strings
names(data) <- plan_of_study_names #rename data in the list using their actual names

#Create the plan of study graphs
curricular_graphs <- lapply(plan_of_study_names,
                            function(x)
                            create_plan_of_study(Course = data[[x]]$Name,
                                                 Term = data[[x]]$Term,
                                                 Prereq = data[[x]]$Prerequisites,
                                                 Coreq = data[[x]]$Corequisites
                                                 )
                           )

#Rename data in the list using their actual names
names(curricular_graphs) <- plan_of_study_names

#Create a table of the structural complexities
structural_complexity_table <- lapply(plan_of_study_names,
                                      function(x)
                                      structural_complexity(curricular_graphs[[x]])
                                      )
aggregate_table_structural <- NULL
for (index in 1:length(plan_of_study_names))
{
  aggregate_table_structural[index] <- structural_complexity_table[[index]]$`Overall Structural Complexity`
}
aggregate_table_structural <- as.data.frame(cbind(plan_of_study_names, aggregate_table_structural))
names(aggregate_table_structural) <- c("Plan of Study","Structural Complexity")

#Create a table of the structural complexities
transfer_delay_table <- lapply(plan_of_study_names,
                                      function(x)
                                      transfer_delay_factor(curricular_graphs[[x]],8)
)

aggregate_table_transfer <- NULL
for (index in 1:length(plan_of_study_names))
{
  aggregate_table_transfer[index] <- transfer_delay_table[[index]]
}

aggregate_table_structural <- as.data.frame(cbind(aggregate_table_structural, aggregate_table_transfer))
names(aggregate_table_structural)[3] <- "Transfer Delay Factor"
aggregate_table_structural$`Structural Complexity` <- as.numeric(as.character(aggregate_table_structural$`Structural Complexity`))
aggregate_table_structural$`Transfer Delay Factor` <- as.numeric(as.character(aggregate_table_structural$`Transfer Delay Factor`))
aggregate_table_structural$Ratio <- aggregate_table_structural$`Transfer Delay Factor`/aggregate_table_structural$`Structural Complexity`
aggregate_table_structural$Ratio <- 100*round(aggregate_table_structural$Ratio, 3)

